#include "TMath.h"
double PI = TMath::Pi();
double twoPI=2*PI;

bool isGoodTrack(PicoDst *tr, int id);
bool isGoodPartner(PicoDst *tr, int id);
bool isEMCTrack(PicoDst *tr,int id);
bool isSMDTrack(PicoDst *tr,int id);
bool checkHotTower(int towId);
void makerealevent();
void clear();
void writeHistograms();

TString FileInPut;
TString FileOutPut;
TString mTrigger[2]={"HT0","HT2"};

TFile *fout;

Int_t mNBadRuns_HT;
float mHTth     = 0;
float mHTAdc0th = 250;
float mHTAdc0thSys = 250;
float mEmcPtth  = 2.5;
float CurrentEvent_bField;
int   CurrentEvent_RunId;
int   CurrentEvent_Id;
float CurrentEvent_Vz;
int   CurrentEvent_nEs;
int   CurrentEvent_nEMCE;
int      CurrentEvent_EId[2000];
int      CurrentEvent_ECharge[2000];
int      CurrentEvent_ENhitsFit[2000];
int      CurrentEvent_ENhitsDedx[2000];
float    CurrentEvent_EDca[2000];
float    CurrentEvent_ETOWE[2000];
float    CurrentEvent_ETOWpovere[2000];
float    CurrentEvent_EDistZ[2000];
float    CurrentEvent_EDistPhi[2000];
int      CurrentEvent_ESMDNEta[2000];
int      CurrentEvent_ESMDNPhi[2000];
float    CurrentEvent_EPt[2000];
float    CurrentEvent_EEta[2000];
float    CurrentEvent_EHelixPx[2000];
float    CurrentEvent_EHelixPy[2000];
float    CurrentEvent_EHelixPz[2000];
float    CurrentEvent_EHelixX[2000];
float    CurrentEvent_EHelixY[2000];
float    CurrentEvent_EHelixZ[2000];

int      CurrentEvent_EMCEId[2000];
int      CurrentEvent_EMCECharge[2000];
int      CurrentEvent_EMCENhitsFit[2000];
int      CurrentEvent_EMCENhitsDedx[2000];
float    CurrentEvent_EMCEDca[2000];
float    CurrentEvent_EMCEPt[2000];
float    CurrentEvent_EMCEHelixPx[2000];
float    CurrentEvent_EMCEHelixPy[2000];
float    CurrentEvent_EMCEHelixPz[2000];
float    CurrentEvent_EMCEHelixX[2000];
float    CurrentEvent_EMCEHelixY[2000];
float    CurrentEvent_EMCEHelixZ[2000];
float    CurrentEvent_EMCETOWpovere[2000];
float    CurrentEvent_EMCEDistZ[2000];
float    CurrentEvent_EMCEDistPhi[2000];
int      CurrentEvent_EMCESMDNEta[2000];
int      CurrentEvent_EMCESMDNPhi[2000];
int      CurrentEvent_EMCEDsmADC[2000];
int      CurrentEvent_EMCEADC0[2000];
float    CurrentEvent_EMCENSigE[2000];
TH1F *hnEvent       = new TH1F("nEvent","nEvent",10,0.,10.);
TH2F *hVpdVz        = new TH2F("vpdVz","vpdVz",400,-200.,200.,400,-200.,200.);
TH2F *hVpdVzcut     = new TH2F("vpdVzcut","vpdVzcut",200,-100.,100.,200,-100.,100.);
TH1F *hVzDiff       = new TH1F("VzDiff","",200,-20.,20.);
TH2F *hAdc0         = new TH2F("Adc0","",1000,0,20,1000,0,2000);
TH2F *hdsmAdc       = new TH2F("dsmAdc","",1000,0,20,100,0,100);
TH2F *hAdc0vsdsmAdc = new TH2F("Adc0vsdsmAdc","",1000,0,2000,100,0,100);
TH2F *hNSigE            = new TH2F("nSigE","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEPt          = new TH2F("nSigEPt","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEPtAdc0      = new TH2F("nSigEPtAdc0","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEPtnHitsFit  = new TH2F("nSigEPtnHitsFit","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEPtnHitsDedx = new TH2F("nSigEPtnHitsDedx","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEPtDca       = new TH2F("nSigEPtDca","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEPtEMCpovere = new TH2F("nSigEPtEMCpovere","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigESMD         = new TH2F("nSigESMD","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEPtSMD       = new TH2F("nSigEPtSMD","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEPtAdc0SMD      = new TH2F("nSigEPtAdc0SMD","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEPtnHitsFitSMD  = new TH2F("nSigEPtnHitsFitSMD","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEPtnHitsDedxSMD = new TH2F("nSigEPtnHitsDedxSMD","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEPtDcaSMD       = new TH2F("nSigEPtDcaSMD","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEPtEMCpovereSMD = new TH2F("nSigEPtEMCpovereSMD","",1000,0.,20.,400,-20.,20.);
TH2F *hAdc0Cut             = new TH2F("Adc0Cut","",1000,0,20,1000,0,2000);
TH2F *hdsmAdcCut           = new TH2F("dsmAdcCut","",1000,0,20,100,0,100);
TH2F *hAdc0vsdsmAdcCut     = new TH2F("Adc0vsdsmAdcCut","",1000,0,2000,100,0,100);
TH2F *hAdc0CutSMD          = new TH2F("Adc0CutSMD","",1000,0,20,1000,0,2000);
TH2F *hdsmAdcCutSMD        = new TH2F("dsmAdcCutSMD","",1000,0,20,100,0,100);
TH2F *hAdc0vsdsmAdcCutSMD  = new TH2F("Adc0vsdsmAdcCutSMD","",1000,0,2000,100,0,100);
TH2F *hnE                   = new TH2F("hnE","nE",10,0,10,10,0,10);
TH2F *hmvspt                = new TH2F("mvspt","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptlike            = new TH2F("mvsptlike","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptAdc0            = new TH2F("mvsptAdc0","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptAdc0like        = new TH2F("mvsptAdc0like","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptnHitsFit        = new TH2F("mvsptnHitsFit","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptnHitsFitlike    = new TH2F("mvsptnHitsFitlike","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptnHitsDedx       = new TH2F("mvsptnHitsDedx","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptnHitsDedxlike   = new TH2F("mvsptnHitsDedxlike","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptDca             = new TH2F("mvsptDca","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptDcalike         = new TH2F("mvsptDcalike","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptEMCpovere       = new TH2F("mvsptEMCpovere","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptEMCpoverelike   = new TH2F("mvsptEMCpoverelike","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptSMD             = new TH2F("mvsptSMD","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptSMDlike         = new TH2F("mvsptSMDlike","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptAdc0SMD         = new TH2F("mvsptAdc0SMD","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptAdc0SMDlike     = new TH2F("mvsptAdc0SMDlike","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptnHitsFitSMD     = new TH2F("mvsptnHitsFitSMD","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptnHitsFitSMDlike = new TH2F("mvsptnHitsFitSMDlike","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptnHitsDedxSMD    = new TH2F("mvsptnHitsDedxSMD","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptnHitsDedxSMDlike= new TH2F("mvsptnHitsDedxSMDlike","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptDcaSMD          = new TH2F("mvsptDcaSMD","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptDcaSMDlike      = new TH2F("mvsptDcaSMDlike","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptEMCpovereSMD    = new TH2F("mvsptEMCpovereSMD","",1000,0.,20.,500,0.,0.5);
TH2F *hmvsptEMCpovereSMDlike= new TH2F("mvsptEMCpovereSMDlike","",1000,0.,20.,500,0.,0.5);
TH2F *hAdc0PHE          = new TH2F("Adc0PHE","",1000,0.,20.,1000,0,2000);
TH2F *hAdc0PHElike      = new TH2F("Adc0PHElike","",1000,0.,20.,1000,0,2000);
TH2F *hnHitsFit         = new TH2F("nHitsFit","",1000,0.,20.,50,0,50);
TH2F *hnHitsFitlike     = new TH2F("nHitsFitlike","",1000,0.,20.,50,0,50);
TH2F *hnHitsDedx        = new TH2F("nHitsDedx","",1000,0.,20.,50,0,50);
TH2F *hnHitsDedxlike    = new TH2F("nHitsDedxlike","",1000,0.,20.,50,0,50);
TH2F *hDca              = new TH2F("Dca","",1000,0.,20.,30,0,3);
TH2F *hDcalike          = new TH2F("Dcalike","",1000,0.,20.,30,0,3);
TH2F *hAdc0PHESMD       = new TH2F("Adc0PHESMD","",1000,0.,20.,1000,0,2000);
TH2F *hAdc0PHESMDlike   = new TH2F("Adc0PHESMDlike","",1000,0.,20.,1000,0,2000);
TH2F *hnHitsFitSMD      = new TH2F("nHitsFitSMD","",1000,0.,20.,50,0,50);
TH2F *hnHitsFitSMDlike  = new TH2F("nHitsFitSMDlike","",1000,0.,20.,50,0,50);
TH2F *hnHitsDedxSMD     = new TH2F("nHitsDedxSMD","",1000,0.,20.,50,0,50);
TH2F *hnHitsDedxSMDlike = new TH2F("nHitsDedxSMDlike","",1000,0.,20.,50,0,50);
TH2F *hDcaSMD           = new TH2F("DcaSMD","",1000,0.,20.,30,0,3);
TH2F *hDcaSMDlike       = new TH2F("DcaSMDlike","",1000,0.,20.,30,0,3);
TH2F *hNSigEeff         = new TH2F("nSigEeff","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEefflike     = new TH2F("nSigEefflike","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEeffSMD      = new TH2F("nSigEeffSMD","",1000,0.,20.,400,-20.,20.);
TH2F *hNSigEeffSMDlike  = new TH2F("nSigEeffSMDlike","",1000,0.,20.,400,-20.,20.);
TH1F *hTPCtracksTag          = new TH1F("TPCtracksTag","",1000,0.,20.);
TH1F *hTPCtracksTaglike      = new TH1F("TPCtracksTaglike","",1000,0.,20.);
TH1F *hSMDtracksTag          = new TH1F("SMDtracksTag","",1000,0.,20.);
TH1F *hSMDtracksTaglike      = new TH1F("SMDtracksTaglike","",1000,0.,20.);
TH1F *hTPCtracks             = new TH1F("TPCtracks","",1000,0.,20.);
TH1F *hTPCtrackslike         = new TH1F("TPCtrackslike","",1000,0.,20.);
TH1F *hEMCmatchingtracks     = new TH1F("EMCmatchingtracks","",1000,0.,20.);
TH1F *hEMCmatchingtrackslike = new TH1F("EMCmatchingtrackslike","",1000,0.,20.);
TH1F *hEMCtracks             = new TH1F("EMCtracks","",1000,0.,20.);
TH1F *hEMCtrackslike         = new TH1F("EMCtrackslike","",1000,0.,20.);
TH1F *hSMDmatchingtracks     = new TH1F("SMDmatchingtracks","",1000,0.,20.);
TH1F *hSMDmatchingtrackslike = new TH1F("SMDmatchingtrackslike","",1000,0.,20.);
TH1F *hSMDtracks             = new TH1F("SMDtracks","",1000,0.,20.);
TH1F *hSMDtrackslike         = new TH1F("SMDtrackslike","",1000,0.,20.);
TH1F *hTPCtracksSMD             = new TH1F("TPCtracksSMD","",1000,0.,20.);
TH1F *hTPCtracksSMDlike         = new TH1F("TPCtracksSMDlike","",1000,0.,20.);
TH1F *hEMCmatchingtracksSMD     = new TH1F("EMCmatchingtracksSMD","",1000,0.,20.);
TH1F *hEMCmatchingtracksSMDlike = new TH1F("EMCmatchingtracksSMDlike","",1000,0.,20.);
TH1F *hEMCtracksSMD             = new TH1F("EMCtracksSMD","",1000,0.,20.);
TH1F *hEMCtracksSMDlike         = new TH1F("EMCtracksSMDlike","",1000,0.,20.);
TH1F *hSMDmatchingtracksSMD     = new TH1F("SMDmatchingtracksSMD","",1000,0.,20.);
TH1F *hSMDmatchingtracksSMDlike = new TH1F("SMDmatchingtracksSMDlike","",1000,0.,20.);
TH1F *hSMDtracksSMD             = new TH1F("SMDtracksSMD","",1000,0.,20.);
TH1F *hSMDtracksSMDlike         = new TH1F("SMDtracksSMDlike","",1000,0.,20.);
